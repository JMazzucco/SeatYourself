<div id="show_deets">
	<div id="res_header_img">
		<%= image_tag @restaurant.image.url(:medium) %>
	</div>

	<div id="res_header_details">
		<h1><%= @restaurant.name %></h1>

		<div class="rating">
			<% if @restaurant.reviews.count > 0 %>
		    <% sum = @restaurant.reviews.sum(:rating) %>
		    <% count = @restaurant.reviews.count %>
		    <% user_rating = (sum / count.to_f).round%>
		    <% empty_stars = 5 - user_rating %>
				<% user_rating.times do |x| %>
					<span class="filled-star" id="<%= x%>">&starf;</span>
			  <% end %>
			  <% empty_stars.times do |x| %>
					<span class="empty-star" id="<%= x%>">&starf;</span>
			  <% end %>
		  <% else %>
		     <% 5.times do |x| %>
					<span class="empty-star" id="<%= x%>">&starf;</span>
					<% end %>
		  <% end %>
		</div>

		<p id="cusine_city"><%= @restaurant.cuisine_type.upcase %> &bull; <%= @restaurant.city.upcase %>
		<p><a href="http://<%= @restaurant.website %>"><%= @restaurant.website %></a></p>

		<% if current_user && current_user.id == @restaurant.owner %>
			<%= link_to "Edit", edit_restaurant_path(@restaurant.id) %>
			<%= link_to "Delete", restaurant_path(@restaurant.id), :method => :delete %>
		<% end %>
	</div>
</div>

<div id="content-bg">
	<div class="tile" id="reso_booking">
		 	<h2>Book a Reservation</h2>
		  <%= form_for([@restaurant, @reservation]) do |f| %>
					<p><%= f.label :time, "Date" %></p>
					<%= f.date_select :time,
				 		:default => 24.hours.from_now,
		        :minute_step => 15,
				    :discard_year => true
				   %>
				  <p>
				  <p><%= f.label :time, "Time" %></p>
				  <%= f.time_select :time,
				 		:default => 24.hours.from_now,
		        :minute_step => 15,
				    :discard_year => true
				  %>
				  </p>

					<p><%= f.label :party_size, "Party Size"%></p>
					<p><%= f.text_field :party_size %></p>
					<%= f.submit 'Book Reservation', id:'reso_submit_btn' %>
			<% end %>
	</div>

	<% if current_user && current_user.reservations.count > 0 %>
		<div class="tile" id="booked_reservations">
			<h2>Your Reservations</h2>
			<ul>
			<% counter = 1 %>
			<% current_user.reservations.each do |reso| %>

				<li>
				<div class="num_list_icon"><span><%= counter %></span></div>
				<div id="reservation"><%= reso.time %> for <%= reso.party_size %> people</li>
<%#= reso.time.strftime("%b %e, %l:%M %p")%>

				<%= link_to 'Cancel', restaurant_reservation_path(restaurant_id: reso.restaurant_id, id: reso.id),  method: :delete, data: { confirm: 'Are you sure?' }, id:"cancel_reso_link" %>
				<% counter += 1%>
			<% end %>
			</div>
			</ul>


	<% end %>

	<div class="tile" id="show_about">
		<h2>About <%= @restaurant.name %></h2>
		<h4><%= @restaurant.address %></h4>

		<p><%= @restaurant.description %></p>

		<div id="gmap">
			<% uri = "https://maps.googleapis.com/maps/api/staticmap?size=500x300&maptype=roadmap\
&markers=size:large%7Ccolor:red%7C" + @restaurant.address %>
			<%= image_tag(uri) %>

		</div>
	</div>

	<div class="tile" id="show_ratings">

	<h2><%= @restaurant.name %> Ratings and Reviews</h2>
		<div class="rating">
		<% if @restaurant.reviews.count > 0 %>
			<% user_rating.times do |x| %>
				<span class="filled-star" id="<%= x%>">&starf;</span>
		  <% end %>
		  <% empty_stars.times do |x| %>
				<span class="empty-star" id="<%= x%>">&starf;</span>
		  <% end %>
		  <span id="rating_count"><%= pluralize(@restaurant.reviews.count, "review") %></span>
	  <% else %>
	     <% 5.times do |x| %>
				<span class="empty-star" id="<%= x%>">&starf;</span>
				<% end %>
				<span id="rating_count">0 reviews</span>
	  <% end %>
		</div>

<hr>
		<% if @restaurant.reviews.count > 0 %>
			<% @restaurant.reviews.each do |r| %>
				<div id="single_review">
					<h3><%= r.title %></h3>
					<% empty_stars_single_review = 5 - r.rating %>
					<% r.rating.times do |x| %>
						<span class="filled-star" id="<%= x%>">&starf;</span>
	  			<% end %>
			  	<% empty_stars_single_review.times do |x| %>
						<span class="empty-star" id="<%= x%>">&starf;</span>
			 		<% end %>
			 		<% if r.rating == 0 %>
			 			<% 5.times do |x| %>
						<span class="empty-star" id="<%= x%>">&starf;</span>
						<% end %>
					<% end %>

					<h4><%= r.user.name.capitalize %>&nbsp
					<span id="datetime_posted"><%= r.created_at.strftime("%B %d, %Y at %l:%M %p") %></span></h4>
						<p><%= r.comment %></p>
					</div>
			<% end %>
		<% end %>

		<% if current_user && @restaurant.reviews.where(user_id: current_user).count == 0  %>

			<%= link_to "Leave a Review", new_restaurant_review_path(@restaurant), id:"new_review_btn"%>
		<% end %>
	</div>

<div class="tile" id="show_nearbys">

	<div id="nearbys_text">
		<h2>Nearby Restaurants</h2>
		<% if @nearby_restaurants != nil && @nearby_restaurants.any? %>
			<% if @nearby_restaurants != nil && @nearby_restaurants.any? %>

			<%= javascript_tag do %>
				window.nearbys = <%= raw @nearby_restaurants.map {|nr| {latitude: nr.latitude, longitude: nr.longitude}}.to_json %>
			<% end %>
		<% end %>
		<ul>
		<% @nearby_restaurants.each do |nr| %>
			<li id="nearby_restaurant">
				<% nr.distance >= 1 ? distance = "#{nr.distance.round(2)} Kilometers" : distance = "#{(nr.distance * 1000).round} Meters" %>
				<%= link_to "#{nr.name}", restaurant_path(nr) %>
				<span><%= distance %></span>
			</li>
		<% end %>
		</ul>
	</div>

<div id="map-canvas" data-latitude='<%= @restaurant.latitude.to_f %>' data-longitude='<%= @restaurant.longitude.to_f %>'></div>
<% else %>
	<p><em>No nearby restaurants found</em></p>
<% end %>
</div>

<!-- <h3>Your Reservations</h3>
	<p>Your reservations for <%#= @restaurant.name %></p>
	<%# if current_user %>
	<%# @restaurant.reservations.where(user_id: current_user).each do |res| %>
			<p>
				<%#= res.time.strftime("%A, %d %B %Y at %l:%M %p") %> for <%#= pluralize(res.party_size, "person") %>
			</p>
				<%#= link_to "Cancel Reservation", restaurant_reservation_path(@restaurant, res), :method => :delete %>
			</p>
			<hr/>
		<%# end %>
	<%# end %> -->
<!--
<%# if current_user %>
	<%#= link_to "leave a review!", new_restaurant_review_path(@restaurant) %>
	<%# if @hours_open.empty? %>
		<h3>Sorry, this restaurant is booked for today!</h3>
	<%# end %>
<%# end %> -->
</div>
